import{isObj as t,isArray as i,isFunc as s,removeListener as e,addListener as r,isString as l,extend as h,def as n}from"@iosio/util";import{obi as o}from"@iosio/obi";let u=document,f=t=>u.createElement(t),a=(t,i)=>t.appendChild(i),c=t=>u.createTextNode(t),m=t=>{let i=f("style");return a(i,c("")),a(t||u.head,i),t=>(a(i,c(t)),i)},d=m(),v=m(),p=(t,i)=>{i=i||String;try{if(i==Boolean?t=[!0,1,"","1","true"].includes(t):"string"==typeof t&&(t=i==Number?Number(t):i==Object||i==Array?JSON.parse(t):t),{}.toString.call(t)==`[object ${i.name}]`)return{value:t,error:i==Number&&Number.isNaN(t)}}catch(t){}return{value:t,error:!0}},b=(s,e,r)=>{null===r||!1===r?s.removeAttribute(e):s.setAttribute(e,((t,i)=>!(!t.getAttribute||!t.localName)&&(i=t.getAttribute("is"),t.localName.includes("-")||i&&i.includes("-")))(s)&&(t(r)||i(r))?JSON.stringify(r):r)},y=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase(),g=t=>t.replace(/-(\w)/g,(t,i)=>i.toUpperCase());v(" .___ {visibility: inherit;}",!0);var w=(t,i)=>t.removeChild(i),N=(t,i,s)=>t.insertBefore(i,s),_=t=>t.toLowerCase(),k={},x=[],$=x.map,C="#document-fragment",S=(t,i)=>i,A=(t,i,s)=>{for(var e in s={},t)s[e]=t[e];for(var e in i)s[e]=i[e];return s},O=function(t){this.handlers[t.type](t)},j=t=>{[].concat(...t.childNodes).forEach(t=>{if(t.handlers)for(let i in t.handlers)e(t,i,O);j(t)})},T=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,B=(t,i,s)=>{"-"===i[0]?t.setProperty(i,s):t[i]="number"==typeof s&&!1===T.test(i)?s+"px":s},E=(i,s,e)=>(t=>t?t.split(/\s+/).filter(t=>t):[])(t(s)?((t,i)=>{i="";for(let s in t)t[s]&&(i+=(i&&" ")+s);return i})(s):s).forEach(t=>i.classList[e](t)),H=(t,i,h,n,o)=>{if("key"===i);else if(!s(n)||!i.startsWith("on")||i in t)"ref"===i&&s(n)?n(t):"style"===i?((i,s,e,r)=>{if(r=t.style,l(s))return r.cssText=s;if(l(e)&&(r.cssText="",e=null),e)for(let t in e)s&&t in s||B(r,t,"");if(s)for(let t in s)e&&s[t]===e[t]||B(r,t,s[t])})(0,n,h):"className"===i||"class"===i?(E(t,h,"remove"),E(t,n,"add")):!o&&"list"!==i&&i in t?t[i]=null==n?"":n:b(t,i,n);else{let s=_(i)in t?_(i.slice(2)):_(i[2])+i.substring(3);((t.handlers||(t.handlers={}))[i=s]=n)?h||r(t,i,O):e(t,i,O)}},J=(t,i)=>{var s=3===t.type?c(t.name):(i=i||"svg"===t.name)?u.createElementNS("http://www.w3.org/2000/svg",t.name):"#document-fragment"===t.name?u.createDocumentFragment():f(t.name),e=t.props;for(var r in e)H(s,r,null,e[r],i);for(var l=0,h=t.children.length;l<h;l++)a(s,J(t.children[l],i));return t.node=s},R=t=>null==t?null:t.key,z=t=>(t.t&&t.t(t),t),L=(t,i,s,e,r)=>{if(s===e);else if(null!=s&&3===s.type&&3===e.type)s.name!==e.name&&(i.nodeValue=e.name);else if(null==s||s.name!==e.name)i=N(t,J(e,r),i),null!=s&&w(t,z(s.node));else{var l,h,n,o,u=s.props,f=e.props,a=s.children,c=e.children,m=0,d=0,v=a.length-1,p=c.length-1;for(var b in r=r||"svg"===e.name,A(u,f)){let t=u[b],s=f[b];(["value","selected","checked"].includes(b)?i[b]:t)!==s&&H(i,b,t,s,r)}for(;d<=p&&m<=v&&null!=(n=R(a[m]))&&n===R(c[d]);)L(i,a[m].node,a[m++],c[d++],r);for(;d<=p&&m<=v&&null!=(n=R(a[v]))&&n===R(c[p]);)L(i,a[v].node,a[v--],c[p--],r);if(m>v)for(;d<=p;)N(i,J(c[d++],r),(h=a[m])&&h.node);else if(d>p)for(;m<=v;)w(i,z(a[m++].node));else{for(var y=m,g={},_={};y<=v;y++)null!=(n=a[y].key)&&(g[n]=a[y]);for(;d<=p;)n=R(h=a[m]),o=R(c[d]),_[n]||null!=o&&o===R(a[m+1])?(null==n&&w(i,z(h.node)),m++):null==o||1===s.type?(null==n&&(L(i,h&&h.node,h,c[d],r),d++),m++):(n===o?(L(i,h.node,h,c[d],r),_[o]=!0,m++):null!=(l=g[o])?(L(i,N(i,l.node,h&&h.node),l,c[d],r),_[o]=!0):L(i,h&&h.node,null,c[d],r),d++);for(;m<=v;)null==R(h=a[m++])&&w(i,z(h.node));for(var y in g)null==_[y]&&w(i,z(g[y].node))}}return e.node=i},M=(t,i,s,e,r,l)=>({name:t,props:i,children:s,node:e,type:l,key:r}),P=(t,i)=>M(t,k,x,i,null,3),Z=t=>3===t.nodeType?P(t.nodeValue,t):M(_(t.nodeName),k,$.call(t.childNodes,Z),t,null,1),q=(t,i)=>((t=L(t.parentNode,t,t.vdom||Z(t),i)).vdom=i,t),D=function(e,r){for(var l,h=[],n=[],o=arguments.length;o-- >2;)h.push(arguments[o]);for(;h.length>0;)if(i(l=h.pop()))for(o=l.length;o-- >0;)h.push(l[o]);else!1===l||!0===l||null==l||n.push(t(l)?l:P(l));return r=r||k,s(e)?e(r,n):M(e,r,n,null,r.key)};let F=Symbol(),G=Symbol(),I={};class K extends HTMLElement{constructor(){super(),this.context=I,this.i=[],this.s={},this.state={},this.Host=(t,i)=>{this.l=!0;for(let i in A(t,this.s))H(this,i,this.s[i],t[i]);return this.s=t,D(C,{},i)},this.setState=t=>{h(this.state,s(t)?t(this.state):t||{}),this.update()},this.observeObi=(...t)=>t.forEach(t=>t.$onChange&&this.i.push(t.$onChange(this.update))),this.update=()=>(this.h||(this.h=this.o.then(t=>{t=[h({Host:this.Host},this[F]),this.state,this.context],this.u?this.m(...t):this.v(...t),this.h=!1})),this.h),this.v=(...t)=>{this.willRender(...t);let i=this.render(...t),s=f(this.l?"template":i.name);a(this.p,s),this.g=q(this.l?this.p:s,i),setTimeout(()=>{this.classList.add("___"),this.didRender(...t),this.i.push(this.lifeCycle()),this.u=!0})},this.m=(...t)=>{let i=this.willRender();(i||void 0===i)&&(q(this.l?this.p:this.g,this.render(...t)),this.didRender())},this.t=t=>{t&&j(t),this.i.forEach(t=>t&&t()),this.N=!0},this[F]={},this.render=this.render.bind(this),this.o=new Promise(t=>this._=t),this.update();let{k:t}=this.constructor,i=t.length;for(;i--;)t[i](this)}connectedCallback(){this.u||(this.attachShadow({mode:"open"}),this.p=this.shadowRoot||this,this.state.$onChange&&this.i.push(this.state.$onChange(this.update)),this.observe&&this.observeObi(this.observe),this._())}attributeChangedCallback(t,i,s){t!==this[G]&&i!==s&&(this[g(t)]=s)}static get observedAttributes(){let{propTypes:t,prototype:i}=this;return this.k=[],t?Object.keys(t).map(s=>{let e=y(s),r=t[s].name?{type:t[s]}:t[s];return s in i||n(i,s,{get(){return this[F][s]},set(t){let{value:i,error:l}=p(t,r.type);if(l&&null!=i)throw`[${s}] must be type [${r.type.name}]`;i!==this[F][s]&&(r.reflect&&this.o.then(()=>{this[G]=e,b(this,e,r.type!==Boolean||i?i:null),this[G]=!1}),this[F][s]=i,this.update())}}),r.value&&this.k.push(t=>t[s]=r.value),e}):[]}lifeCycle(){}willRender(){}render(){}didRender(){}disconnectedCallback(){!this.N&&this.t()}}const Q=(t,i,s)=>{var e,r;return(t=>v(`${t} {visibility:hidden}`))(t),customElements.define(t,i.prototype instanceof K?i:(r=e=class extends K{constructor(...t){super(...t),this.render=i}},e.propTypes=s,r)),(i,s)=>D(t,i,s)},U=(t,i,s)=>Q("x-"+t,i,s),V=(i,e)=>{let r=s(e)?o(e(I)):t(e)?o(e):e;return I[i]=r,r};export{S as Fragment,K as Xelement,I as context,Q as element,d as globalStyles,D as h,V as provide,U as x};
