{"version":3,"file":"utils.js","sources":["../src/utils.js"],"sourcesContent":["//\n\n\n/*------------------ TYPE CHECKING -------------------------- */\n\n\nexport const isArray = Array.isArray;\nexport const isObj = (thing) => Object.prototype.toString.call(thing) === '[object Object]';\nexport const isFunc = (thing) => typeof thing === 'function';\nexport const isString = (thing) => typeof thing === 'string';\nexport const isNum = (thing) => !isNaN(parseFloat(thing)) && !isNaN(thing - 0);\n\n\n/*------------------ DOM -------------------------- */\nconst w = window;\nexport const d = document;\nexport const createElement = (elem) => d.createElement(elem);\nexport const appendChild = (node, child) => node.appendChild(child);\nexport const createTextNode = (text) => d.createTextNode(text);\nexport const toLowerCase = (toLower) => toLower.toLowerCase();\nexport const toUpperCase = (toUpper) => toUpper.toUpperCase();\nexport const addListener = (to, ev, cb) => to.addEventListener(ev, cb);\nexport const removeListener = (from, ev, cb) => from.removeEventListener(ev, cb);\nexport const eventListener = (to, ev, cb) => {\n    if (!isArray(to)) return addListener(to, ev, cb), () => removeListener(to, ev, cb);\n    let unListenAll = [];\n    to.forEach(l => {\n        addListener(l[0], l[1], l[2]);\n        unListenAll.push(() => removeListener(l[0], l[1], l[2]));\n    });\n    return () => unListenAll.forEach(f => f());\n};\n\nexport const is_ie_or_old_edge = () => navigator.userAgent.indexOf(\"MSIE\") !== -1 || !!w.StyleMedia || !!d.documentMode === true;\n\nexport const ScrollStopper = (_stopScroll, _xscroll, _yscroll, _w) => {\n    _w = _w || w;\n    addListener(_w, 'scroll', () => _stopScroll && _w.scrollTo(_xscroll, _yscroll));\n    return {\n        stop: () => {\n            _stopScroll = true;\n            _xscroll = _w.pageXOffset;// || window.document.documentElement.scrollLeft\n            _yscroll = _w.pageYOffset;// || window.document.documentElement.scrollTop;\n        },\n        go: () => (_stopScroll = false)\n    }\n};\n\n/*------------------ STYLES -------------------------- */\n\nexport const CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE = \"adoptedStyleSheets\" in document;\n\n/**\n * creates a single style sheet. returns a function to update the same sheet\n * @param {node|| null} mount - pass the node to mount the style element to defaults to document head\n * @returns {function} for adding styles to the same stylesheet\n */\nexport const headStyleTag = (mount) => {\n    let style = createElement('style');\n    appendChild(style, createTextNode(\"\"));\n    appendChild(mount || d.head, style);\n    return (css) => (appendChild(style, createTextNode(css)), style);\n};\nexport const globalStyles = headStyleTag();\nexport const webComponentVisibilityStyleSheet = headStyleTag();\n\nexport const webComponentVisibility = (tag) => webComponentVisibilityStyleSheet(`${tag} {visibility:hidden}`);\n\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i;\n\nexport const pixelfyValue = (key, value) => typeof value === 'number' && IS_NON_DIMENSIONAL.test(key) === false ? value + 'px' : value;\n\nexport const toCssVarsFromJsThemeObj = (themeObj) =>\n    Object.keys(themeObj).reduce((acc, curr) => ((acc[curr] = `var(--${curr},${themeObj[curr]})`), acc), {});\n\nexport const convertThemeToCssVars = (vars, selector) =>\n    `${selector || ':root'}{${Object.keys(vars).map((key) => `--${key}:${vars[key]};`).join('')}}`;\n\nexport const raf = (fn) => requestAnimationFrame(fn);\n\n\nexport const CSSTextToObj = cssText => {\n    var style = {},\n        cssToJs = s => s.startsWith('-') ? s : s.replace(/\\W+\\w/g, match => toUpperCase(match.slice(-1))),\n        properties = cssText.split(\";\").map(o => o.split(\":\").map(x => x && x.trim()));\n    for (var [property, value] of properties) {\n        let prop = cssToJs(property);\n        if (prop) style[prop] = value;\n    }\n    return style\n};\n\nexport const tagStyleCache = {}; // cache the instance css to the tagName\n\nexport const createStyleSheet = (cssText, async) => {\n    let sheet = false;\n    if (CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE) {\n        sheet = new CSSStyleSheet();\n        sheet[async ? 'replace' : 'replaceSync'](cssText);\n    }\n    return [sheet, cssText];\n};\n\n\n/*------------------ WEB COMPONENT -------------------------- */\nexport const COMPONENT_MOUNTED_ATTRIBUTE = 'x-mounted';\n/**\n * for parsing the incoming attributes into consumable props\n * @param value\n * @param type\n * @returns {{error: boolean, value: *}}\n */\nexport const formatType = (value, type) => {\n    type = type || String;\n    try {\n        if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n        else if (typeof value == \"string\") {\n            value = type == Number ? Number(value)\n                : type == Object || type == Array ? JSON.parse(value) : value;\n        }\n        if ({}.toString.call(value) == `[object ${type.name}]`)\n            return {value, error: type == Number && Number.isNaN(value)};\n    } catch (e) {\n    }\n    return {value, error: true};\n};\n\nexport const isCustomElement = (el, isAttr) => {\n    if (!el.getAttribute || !el.localName) return false;\n    isAttr = el.getAttribute('is');\n    return el.localName.includes('-') || isAttr && isAttr.includes('-');\n};\n/**\n * will set or remove the attribute based on the truthyness of the value.\n * if the type of value is object or array and the node is a custom element, it will json stringify the value\n * @param node\n * @param attr\n * @param value\n */\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false)\n        ? node.removeAttribute(attr)\n        : node.setAttribute(attr, isCustomElement(node) && (isObj(value) || isArray(value)) ? JSON.stringify(value) : value);\n};\n\n\nexport const propToAttr = (prop) => toLowerCase(prop.replace(/([A-Z])/g, \"-$1\"));\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => toUpperCase(letter));\n\n\n/*------------------ MISC -------------------------- */\n\n\nexport const extend = (obj, props) => {\n    for (let i in props) obj[i] = props[i];\n    return obj\n};\n\nexport const propsChanged = (a, b) => {\n    a = a || {};\n    b = b || {};\n    for (let i in a) if (!(i in b)) return true;\n    for (let i in b) if (a[i] !== b[i]) return true;\n    return false\n};\n\nexport const objectIsEmpty = obj => Object.keys(obj || {}).length === 0;\n\nexport const arrayIncludesItemFromArray = (arr1, arr2) => {\n    let len1 = arr1.length, len2 = arr2.length;\n    if (!len1 && !len2 || len1 && !len2 || !len1 && len2) return false;\n    for (let i = len1; i--;) if (arr2.includes(arr1[i])) return true;\n    return false;\n};\n\n\n// const handler = {\n//     set(target, key, value) {\n//         console.log(`Setting value ${key} as ${value}`)\n//         target[key] = value;\n//     },\n// };\n\n// const proxyObj = new Proxy({hello: '123'}, handler);\n\nexport const Subie = () => {\n    let subs = [],\n        unsub = (sub, i) => {\n            let out = [];\n            for (i = subs.length; i--;) subs[i] === sub ? (sub = null) : (out.push(subs[i]));\n            subs = out;\n        };\n    return {\n        unsub,\n        sub: sub => (subs.push(sub), () => unsub(sub)),\n        notify: data => subs.forEach(s => s && s(data))\n    }\n};\n\n\nexport const def = (obj, prop, handlers) => Object.defineProperty(obj, prop, handlers);\n\n\n/*------------------ CONSTANTS -------------------------- */\n\nexport const TEST_ENV = process.env.NODE_ENV === 'test';\n\n\n\n/*\n\n\n    CSSTextToObj = cssText => {\n        var style = {},\n            cssToJs = s => s.startsWith('-') ? s : s.replace(/\\W+\\w/g, match => toUpperCase(match.slice(-1))),\n            properties = cssText.split(\";\").map(o => o.split(\":\").map(x => x && x.trim()));\n        for (var [property, value] of properties){\n            let prop = cssToJs(property);\n            if(prop)style[prop] = value;\n        }\n        return style\n    },\n\n\nfunction CSSTextToObj(cssText) {\n    var cssTxt = cssText.replace(/\\/\\*(.|\\s)*?\\*\\//g, \" \").replace(/\\s+/g, \" \");\n    var style = {},\n        [,ruleName,rule] = cssTxt.match(/ ?(.*?) ?{([^}]*)}/)||[,,cssTxt];\n\n    var cssToJs = s => s.replace(/\\W+\\w/g, match => match.slice(-1).toUpperCase());\n\n    var properties = rule.split(\";\").map(o => o.split(\":\").map(x => x && x.trim()));\n\n    for (var [property, value] of properties) style[cssToJs(property)] = value;\n    return {cssText, ruleName, style};\n}\n\n\n\n    addDash = attr => {\n        while (attr.indexOf('-') > 0) { // - is in the attribute name, but is not the first character either\n            var afterDash = attr.substring(attr.indexOf('-') + 1)\n            afterDash = afterDash.substring(0, 1).toUpperCase() + afterDash.substring(1)\n            attr = attr.substring(0, attr.indexOf('-')) + afterDash\n        }\n        return attr\n    },\n    cssStringToObj = (str) => {\n        let _out = {};\n        str = str || '';\n        str.split(';').forEach(string => {\n            if (string !== '') {\n                var attr = string.split(':');\n                let attrName;\n                if (attr.length > 2) {\n                    attrName = attr.shift();\n                    attrName = addDash(attrName);\n                    _out[attrName] = attr.join(':')\n                } else {\n                    attrName = addDash(attr[0]);\n                    _out[attrName] = attr[1]\n                }\n            }\n        });\n        return _out;\n    };\n\n */"],"names":["isArray","Array","isObj","thing","Object","prototype","toString","call","isFunc","isString","isNum","isNaN","parseFloat","w","window","d","document","createElement","elem","appendChild","node","child","createTextNode","text","toLowerCase","toLower","toUpperCase","toUpper","addListener","to","ev","cb","addEventListener","removeListener","from","removeEventListener","eventListener","unListenAll","forEach","l","push","f","is_ie_or_old_edge","navigator","userAgent","indexOf","StyleMedia","documentMode","ScrollStopper","_stopScroll","_xscroll","_yscroll","_w","scrollTo","stop","pageXOffset","pageYOffset","go","CONSTRUCTABLE_STYLE_SHEETS_AVAILABLE","headStyleTag","mount","style","head","css","globalStyles","webComponentVisibilityStyleSheet","webComponentVisibility","tag","IS_NON_DIMENSIONAL","pixelfyValue","key","value","test","toCssVarsFromJsThemeObj","themeObj","keys","reduce","acc","curr","convertThemeToCssVars","vars","selector","map","join","raf","fn","requestAnimationFrame","CSSTextToObj","cssText","cssToJs","s","startsWith","replace","match","slice","properties","split","o","x","trim","property","prop","tagStyleCache","createStyleSheet","async","sheet","CSSStyleSheet","COMPONENT_MOUNTED_ATTRIBUTE","formatType","type","String","Boolean","includes","Number","JSON","parse","name","error","e","isCustomElement","el","isAttr","getAttribute","localName","updateAttribute","attr","removeAttribute","setAttribute","stringify","propToAttr","attrToProp","all","letter","extend","obj","props","i","propsChanged","a","b","objectIsEmpty","length","arrayIncludesItemFromArray","arr1","arr2","len1","len2","Subie","subs","unsub","sub","out","notify","data","def","handlers","defineProperty","TEST_ENV","undefined"],"mappings":"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"}